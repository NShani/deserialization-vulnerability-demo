package org.wso2.sample.deserialization.handler.java;

import org.wso2.sample.deserialization.model.CommandExecutor;
import org.wso2.sample.deserialization.model.Person;
import org.wso2.sample.deserialization.model.TaskExecutor;
import org.wso2.sample.deserialization.model.Hidden;

import java.io.FileOutputStream;
import java.io.IOException;
import java.io.ObjectOutputStream;
import java.util.Date;
import java.util.Scanner;

public class JavaSerializer {

    public static void main(String[] args) throws IOException {
        //Person object
        Person person = new Person();
        person.name="Person name";
        person.birthday=new Date(0*1337);

        //Hidden class object
        Hidden hidden = new Hidden();

        //TaskExecutor object
        CommandExecutor commandExecutor = new CommandExecutor(
                "/home/nadeeshani/BurpSuiteFree/BurpSuiteFree");
        TaskExecutor taskExecutor = new TaskExecutor(commandExecutor);

        Scanner in = new Scanner(System.in);
        try {
            ObjectOutputStream objectOutputStream = new ObjectOutputStream(
                    new FileOutputStream("src/main/resources/person.bin"));
            System.out.println("Which class needs to be serialized? Enter the number..");
            System.out.println("1. Hidden.java");
            System.out.println("2. TaskExecutor.java");
            System.out.println("3. Person.java");
            int choice = in.nextInt();
            if(choice == 1) {
                //simple example 1
                objectOutputStream.writeObject(hidden);
            } else if(choice == 2) {
                //simple example 2
                objectOutputStream.writeObject(taskExecutor);
            } else if(choice == 3) {
                //correct person serialization
                objectOutputStream.writeObject(person);
            }
            objectOutputStream.flush();
        } catch (IOException | ClassCastException e) {
            System.out.println("Unsupported data..");
        }
    }
}
